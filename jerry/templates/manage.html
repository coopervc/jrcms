{% extends "admin.html" %}
{% block title %}管理文章{% endblock %}
{% block content %}
<div>
    <h2 class="subtitle" style="display:inline-block;">{% if deleted %}回收站{% else %}管理文章{% endif %}</h2>
    {% if prev_url %}<a href="{{prev_url}}">上一页</a>
    {% else %}上一页
    {% endif %}
    {% if next_url %}<a href="{{next_url}}">下一页</a>
    {% else %}下一页
    {% endif %}
</div>
<table class="table table-striped">
    <tr>
        <th>标题</th>
        <th>标签</th>
        <th>发布日期</th>
        <th>操作</th>
    </tr>
    {% for post in posts %}
    <tr>
        <td><a href="/edit/{{post.id}}">{{post.title}}</a></td>
        <td>{% for tag in post.tags %}<a href="/manage?tagid={{tag.id}}">{{tag.name}}</a> {% endfor %}</td>
        <td>{{post.published|date_format}}</td>
        <td>
            <a href="/posts/{{post.id}}">查看</a>
            <a href="/posts/{{post.id}}" class="update">{% if post.sticky %}取消置顶{% else %}置顶{% endif %}</a>
            <a href="/posts/{{post.id}}" class="update">{% if post.deleted %}恢复{% else %}删除{% endif %}</a>
        </td>
    </tr>
    {% endfor %}
</table>
<script src="http://libs.useso.com/js/jquery/2.1.1/jquery.min.js"></script>
<script>
$('a.update').click(function(e) {
    e.preventDefault();
    var text = $(this).text();
    var data;
    if ('置顶' == text) {
        data = {column: 'sticky', value: 1};
    } else if ('取消置顶' == text) {
        data = {column: 'sticky', value: 0};
    } else if ('删除' == text) {
        data = {column: 'deleted', value: 1};
    } else if ('恢复' == text) {
        data = {column: 'deleted', value: 0};
    } else {
        return;
    }
    $.ajax({
        method: 'PUT',
        url: $(this).attr('href'),
        data: data
    }).done(function(msg) {
        location = location;
    });
});
</script>
{% endblock %}